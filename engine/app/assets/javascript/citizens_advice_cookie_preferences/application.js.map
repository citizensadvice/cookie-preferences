{
  "version": 3,
  "sources": ["../../../javascript/citizens_advice_cookie_preferences/helpers/analytics.js", "../../../javascript/citizens_advice_cookie_preferences/components/cookie-banner.js", "../../../javascript/citizens_advice_cookie_preferences/components/cookie-preferences-page.js", "../../../javascript/citizens_advice_cookie_preferences/application.js"],
  "sourcesContent": ["export function loadAnalytics() {\n  if (!window.gaGlobal) {\n    // Load gtm script\n    // Script based on snippet at https://developers.google.com/tag-manager/quickstart\n    // prettier-ignore\n    (function (w, d, s, l, i) {\n            w[l] = w[l] || []\n            w[l].push({\n                'gtm.start': new Date().getTime(),\n                event: 'gtm.js'\n            })\n\n            const j = d.createElement(s)\n            const dl = l !== 'dataLayer' ? `&l=${l}` : ''\n            var csp_nonce = document.getElementsByName('csp-nonce')[0].getAttribute('content');\n            j.async = true\n            j.src = `https://www.googletagmanager.com/gtm.js?id=${i}${dl}`\n            j.setAttribute('nonce',csp_nonce)\n            document.head.appendChild(j)\n        })(window, document, 'script', 'dataLayer', 'GTM-P3B74464')\n  }\n}\n\nexport function acceptCookiesGTMEvent() {\n  window.dataLayer.push({\n    event: \"acceptAllCookies\",\n  });\n}\n\nexport function analyticsCookiesAcceptedDlv() {\n  window.dataLayer.push({\n    analyticsCookiesAccepted: \"True\",\n  });\n}\n", "import {\n  loadAnalytics,\n  acceptCookiesGTMEvent,\n  analyticsCookiesAcceptedDlv,\n} from \"../helpers/analytics\";\n\nconst selectors = {\n  cookieBanner: \".js-cookie-banner\",\n  acceptBtn: \"#js-cookie-banner__button-accept\",\n  rejectBtn: \"#js-cookie-banner__button-reject\",\n  cookieSelectionContainer: \".js-cookie-banner__selection-container\",\n  confirmationMessageContainer: \".js-cookie-banner__confirmation-message\",\n  confirmationMessageAccept: \".js-cookie-banner__confirmation-accept\",\n  confirmationMessageReject: \".js-cookie-banner__confirmation-reject\",\n  hideBannerBtn: \"#js-cookie-banner__button-hide\",\n};\n\nconst DEFAULT_COOKIE_CONSENT = {\n  essential: true,\n  analytics: false,\n  video_players: false,\n};\n\nconst cookieDomain =\n  document.location.hostname === \"localhost\"\n    ? \"localhost\"\n    : \"citizensadvice.org.uk\";\n\nfunction setCookie(cname, cvalue, exdays) {\n  // set expiry date in milliseconds\n  const d = new Date();\n  d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);\n  let expires = \"expires=\" + d.toUTCString();\n  document.cookie =\n    cname +\n    \"=\" +\n    cvalue +\n    \";\" +\n    expires +\n    \";path=/\" +\n    `;domain=${cookieDomain}`;\n}\n\nfunction getCookie(name) {\n  const nameEQ = `${name}=`;\n  const cookies = document.cookie.split(\";\");\n  for (let i = 0, len = cookies.length; i < len; i++) {\n    let cookie = cookies[i];\n    while (cookie.charAt(0) === \" \") {\n      cookie = cookie.substring(1, cookie.length);\n    }\n    if (cookie.indexOf(nameEQ) === 0) {\n      return decodeURIComponent(cookie.substring(nameEQ.length));\n    }\n  }\n  return null;\n}\n\nconst acceptCookies = () => {\n  setCookie(\n    \"cookie_preference\",\n    encodeURIComponent(\n      JSON.stringify({\n        essential: true,\n        analytics: true,\n        video_players: true,\n      }),\n    ),\n    365,\n  );\n\n  var cookie_current_version = document\n    .getElementsByClassName(\"js-cookie-banner\")[0]\n    .getAttribute(\"data-cookie-current-version\");\n  setCookie(\"cookie_preference_set\", cookie_current_version, 365);\n  showConfirmationMessage();\n  document.querySelector(selectors.confirmationMessageAccept).hidden = false;\n};\n\nconst rejectCookies = () => {\n  setCookie(\n    \"cookie_preference\",\n    encodeURIComponent(JSON.stringify(DEFAULT_COOKIE_CONSENT)),\n    365,\n  );\n\n  var cookie_current_version = document\n    .getElementsByClassName(\"js-cookie-banner\")[0]\n    .getAttribute(\"data-cookie-current-version\");\n  setCookie(\"cookie_preference_set\", cookie_current_version, 365);\n  showConfirmationMessage();\n  document.querySelector(selectors.confirmationMessageReject).hidden = false;\n};\n\nfunction hideCookieBanner() {\n  const cookieBanner = document.querySelector(selectors.cookieBanner);\n  if (cookieBanner) {\n    cookieBanner.hidden = true;\n  }\n}\n\nfunction showConfirmationMessage() {\n  const cookieBanner = document.querySelector(selectors.cookieBanner);\n\n  const confirmationMessageContainer = document.querySelector(\n    selectors.confirmationMessageContainer,\n  );\n  document.querySelector(selectors.cookieSelectionContainer).hidden = true;\n  confirmationMessageContainer.hidden = false;\n  confirmationMessageContainer.focus();\n  cookieBanner.classList.add(\"cookie-banner--no-decoration\");\n}\n\nfunction setDefaultCookies() {\n  if (getCookie(\"cookie_preference_set\")) {\n    hideCookieBanner();\n  } else {\n    const cookieBanner = document.querySelector(selectors.cookieBanner);\n    cookieBanner.hidden = false;\n    cookieBanner.removeAttribute(\"aria-hidden\");\n    setCookie(\n      \"cookie_preference\",\n      encodeURIComponent(JSON.stringify(DEFAULT_COOKIE_CONSENT)),\n      365,\n    );\n  }\n}\n\nfunction addCookieBannerEventHandlers() {\n  document.querySelector(selectors.acceptBtn).addEventListener(\"click\", () => {\n    acceptCookies();\n    loadAnalytics();\n    acceptCookiesGTMEvent();\n    analyticsCookiesAcceptedDlv();\n  });\n\n  document.querySelector(selectors.rejectBtn).addEventListener(\"click\", () => {\n    rejectCookies();\n  });\n\n  document\n    .querySelector(selectors.hideBannerBtn)\n    .addEventListener(\"click\", () => {\n      hideCookieBanner();\n    });\n}\n\nexport default function initCookieBanner() {\n  const cookieBanner = document.querySelector(selectors.cookieBanner);\n\n  if (cookieBanner) {\n    setDefaultCookies();\n    addCookieBannerEventHandlers();\n  }\n}\n", "export default function initCookiePreferencesPage() {\n  const formContainer = document.getElementById(\"js-enabled-cookie-form\");\n  if (formContainer) {\n    formContainer.hidden = false;\n    formContainer.removeAttribute(\"aria-hidden\");\n  }\n}\n", "import initCookieBanner from \"./components/cookie-banner\";\nimport initCookiePreferencesPage from \"./components/cookie-preferences-page\";\n\ninitCookieBanner();\ninitCookiePreferencesPage();\n"],
  "mappings": "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",
  "names": ["loadAnalytics", "w", "d", "s", "l", "i", "j", "dl", "csp_nonce", "acceptCookiesGTMEvent", "analyticsCookiesAcceptedDlv", "selectors", "DEFAULT_COOKIE_CONSENT", "cookieDomain", "setCookie", "cname", "cvalue", "exdays", "d", "expires", "getCookie", "name", "nameEQ", "cookies", "i", "len", "cookie", "acceptCookies", "cookie_current_version", "showConfirmationMessage", "rejectCookies", "hideCookieBanner", "cookieBanner", "confirmationMessageContainer", "setDefaultCookies", "addCookieBannerEventHandlers", "loadAnalytics", "acceptCookiesGTMEvent", "analyticsCookiesAcceptedDlv", "initCookieBanner", "initCookiePreferencesPage", "formContainer", "initCookieBanner", "initCookiePreferencesPage"]
}
